<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.2.0/papaparse.min.js"></script>
    <style>
        .pdfobject-container {
            height: 500px;
        }

        .pdfobject {
            border: 1px solid #666;
        }
    </style>
</head>
<body>
<div class="container" style="padding:10px 10px;">
    <h1>Read CSV file using JavaScript</h1>
    <div id="header">
        <div style="padding-bootom:10px">
        </div>
    </div>
    <div class="well">
        <div class="row">
            <form class="form-inline">
                <div class="form-group">
                    <label for="files">Upload a CSV formatted file:</label>
                    <input type="file" id="files" class="form-control" accept=".csv" required="">
                </div>
                <div class="form-group">
                    <button type="submit" id="submit-file" class="btn btn-primary">Convert</button>
                </div>
            </form>
        </div>
        <div class="row">
            <div id="parsed_csv_list"></div>
        </div>
    </div>

    <div class="row">
        <textarea id="output" class="form-control" rows="5"></textarea>
    </div>
</div>
</div>
<div class="row" style="margin:30px 0px 50px 50px;">
    <a class="btn btn-default read-more" style="background:#3399ff;color:white"
       href="https://www.js-tutorials.com/javascript-tutorial/reading-csv-file-using-javascript-html5/">Back to
        Tutorial</a>
</div>
<div id="footer">
    <div style="padding-top:10px">
        <!-- Ezoic - top-page - top_of_page -->
        <div id="ezoic-pub-ad-placeholder-100">
            <!-- responsive-336 -->
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1657751670778791"
                 data-ad-slot="5334669865" data-ad-format="auto"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>

        </div>
        <!-- End Ezoic - top-page - top_of_page -->
    </div>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-77843486-1', 'auto');
        ga('send', 'pageview');

    </script>
</div>


<script type="text/javascript">
    $(document).ready(function () {
        $('#submit-file').on("click", function (e) {
            e.preventDefault();
            $('#files').parse({
                config: {
                    delimiter: "auto",
                    complete: convertJSON,
                },
                before: function (file, inputElem) {
                    //console.log("Parsing file...", file);
                },
                error: function (err, file) {
                    //console.log("ERROR:", err, file);
                },
                complete: function () {
                    //console.log("Done with all files");
                }
            });
        });

        function convertJSON(results) {
            if (!results.data) {
                console.log('Invalid data')
                return
            }

            const rawHeader = results.data[0]
            const headers = rawHeader.join(",").toLowerCase().split(",");

            let output = [];

            const data = results.data;
            let currentGroupName = '';
            let variables = [];
            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                const cells = row.join(",").toLowerCase().split(",");

                // reach new group and has old group value -> push and create new group
                if (currentGroupName.length > 0 && variables.length > 0 && cells[0].length > 0) {
                    const tempArray = JSON.parse(JSON.stringify(variables));
                    const obj = {
                        group_name: currentGroupName,
                        variables: tempArray
                    };

                    output.push(obj);
                }

                // reach new group
                if (cells[0]) {
                    currentGroupName = cells[0];
                    variables = [];
                }

                if (cells[1]) {
                    variables.push(cells[1])
                }
            }

            $("#output").text(JSON.stringify(output));
        }
    });
</script>
</body>
</html>